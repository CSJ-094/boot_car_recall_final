<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.boot.dao.FaqDAO">
    <resultMap id="faqResultMap" type="com.boot.dto.FaqDTO">
        <result property="faq_id" column="faqNo"/>
        <result property="category" column="faqCategory"/>
        <result property="question" column="faqTitle"/>
        <result property="answer" column="faqContent"/>
        <result property="created_at" column="created_at"/>
    </resultMap>

    <select id="listWithPaging" resultMap="faqResultMap">
        SELECT faqNo, faqCategory, faqTitle, faqContent, TO_CHAR(faqDate, 'YYYY-MM-DD') as created_at
        FROM (
            SELECT faqNo, faqCategory, faqTitle, faqContent, faqDate, ROWNUM as rnum,
                   TO_CHAR(faqDate, 'YYYY-MM-DD') as created_at
            FROM (
                SELECT faqNo, faqCategory, faqTitle, faqContent, faqDate
                FROM tbl_faq
                ORDER BY faqNo DESC
            )
            WHERE ROWNUM &lt;= #{pageNum} * #{amount}
        )
        WHERE rnum > (#{pageNum} - 1) * #{amount}
    </select>

    <select id="getTotalCount" resultType="int">
        SELECT count(*) FROM tbl_faq
    </select>

    <select id="getFaq" resultMap="faqResultMap">
        SELECT faqNo, faqCategory, faqTitle, faqContent, TO_CHAR(faqDate, 'YYYY-MM-DD HH24:MI') as created_at FROM tbl_faq WHERE faqNo = #{faq_id}
    </select>

    <insert id="write">
        <selectKey keyProperty="faq_id" resultType="long" order="BEFORE">
            SELECT faq_seq.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO tbl_faq (faqNo, faqCategory, faqTitle, faqContent)
        VALUES (#{faq_id}, #{category}, #{question}, #{answer})
    </insert>

    <update id="modify">
        UPDATE tbl_faq SET faqCategory = #{category}, faqTitle = #{question}, faqContent = #{answer}, faqDate = SYSDATE WHERE faqNo = #{faq_id}
    </update>

    <delete id="delete">
        DELETE FROM tbl_faq WHERE faqNo = #{faq_id}
    </delete>
</mapper>
