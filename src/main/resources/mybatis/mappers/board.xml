<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.boot.dao.BoardDAO">


    <insert id="write" parameterType="hashmap">
        INSERT INTO RECALL_BOARD (
        BOARD_NO,
        BOARD_TITLE,
        BOARD_CONTENT,
        BOARD_NAME,
        BOARD_DATE,
        HIT
        ) VALUES (
        RECALL_BOARD_SEQ.NEXTVAL,
        #{boardTitle},
        #{boardContent},
        #{boardName},
        SYSDATE,
        0
        )
    </insert>

    <resultMap id="boardResultMap" type="com.boot.dto.BoardDTO">
        <result property="boardNo" column="BOARD_NO"/>
        <result property="boardTitle" column="BOARD_TITLE"/>
        <result property="boardContent" column="BOARD_CONTENT"/>
        <result property="boardName" column="BOARD_NAME"/>
        <result property="boardDate" column="BOARD_DATE"/>
        <result property="hit" column="BOARD_HIT"/>
    </resultMap>

    <select id="list" resultMap="boardResultMap">
        SELECT BOARD_NO, BOARD_TITLE, BOARD_CONTENT, BOARD_NAME, BOARD_DATE, HIT
        FROM RECALL_BOARD
        ORDER BY BOARD_NO DESC
    </select>

    <select id="listWithPaging" resultMap="boardResultMap">
        SELECT BOARD_NO, BOARD_TITLE, BOARD_NAME, BOARD_DATE, HIT
        FROM (
             SELECT ROWNUM AS rnum, BOARD_NO, BOARD_TITLE, BOARD_NAME, BOARD_DATE, HIT
             FROM (
                  SELECT BOARD_NO, BOARD_TITLE, BOARD_NAME, BOARD_DATE, HIT
                  FROM RECALL_BOARD
                  ORDER BY BOARD_NO DESC
              )
             WHERE ROWNUM &lt;= #{pageNum} * #{amount}
         )
        WHERE rnum &gt; (#{pageNum} - 1) * #{amount}
    </select>

    <select id="getTotalCount" parameterType="com.boot.dto.Criteria" resultType="int">
        SELECT COUNT(*) FROM RECALL_BOARD
        <where>
            <!-- 향후 검색 기능 추가 시 여기에 if문을 사용하여 동적 쿼리 작성 -->
            <!-- 예: <if test="type == 'T'.toString()"> (BOARD_TITLE LIKE '%' || #{keyword} || '%') </if> -->
        </where>
    </select>

    <select id="contentView" parameterType="int" resultMap="boardResultMap">
        SELECT
            BOARD_NO, BOARD_TITLE, BOARD_CONTENT, BOARD_NAME, BOARD_DATE, HIT
        FROM RECALL_BOARD
        WHERE BOARD_NO = #{boardNo}
    </select>

    <update id="hitUp" parameterType="int">
        UPDATE RECALL_BOARD SET HIT = HIT + 1
        WHERE BOARD_NO = #{boardNo}
    </update>

    <update id="modify" parameterType="hashmap">
        UPDATE RECALL_BOARD
        SET BOARD_TITLE = #{boardTitle},
        BOARD_CONTENT = #{boardContent},
        BOARD_NAME = #{boardName}
        WHERE BOARD_NO = #{boardNo}
    </update>

    <delete id="delete" parameterType="int">
        DELETE FROM RECALL_BOARD WHERE BOARD_NO = #{boardNo}
    </delete>

</mapper>