<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.boot.dao.PageDAO">

    <sql id="criteria">
        <if test="keyword != null and keyword != '' and type != null and type != ''">
            <choose>
                <when test='type == "T"'>
                    AND BOARD_TITLE LIKE '%' || #{keyword} || '%'
                </when>
                <when test='type == "C"'>
                    AND BOARD_CONTENT LIKE '%' || #{keyword} || '%'
                </when>
                <when test='type == "TC"'>
                    AND (BOARD_TITLE LIKE '%' || #{keyword} || '%'
                    OR BOARD_CONTENT LIKE '%' || #{keyword} || '%')
                </when>
            </choose>
        </if>
    </sql>

    <select id="listWithPaging" parameterType="com.boot.dto.Criteria" resultType="com.boot.dto.BoardDTO">
        <![CDATA[
        SELECT BOARD_NO AS boardNo,
               BOARD_NAME AS boardName,
               BOARD_TITLE AS boardTitle,
               BOARD_CONTENT AS boardContent,
               BOARD_DATE AS boardDate,
               HIT AS boardHit
        FROM (
            SELECT ROWNUM AS rnum,
                   b.BOARD_NO, b.BOARD_NAME, b.BOARD_TITLE, b.BOARD_CONTENT, b.BOARD_DATE, b.HIT
            FROM (
                SELECT BOARD_NO, BOARD_NAME, BOARD_TITLE, BOARD_CONTENT, BOARD_DATE, HIT
                FROM RECALL_BOARD
                WHERE 1=1
        ]]>
        <include refid="criteria"/>
        <![CDATA[
                ORDER BY BOARD_NO DESC
            ) b
            WHERE ROWNUM <= #{pageNum} * #{amount}
        )
        WHERE rnum > (#{pageNum}-1) * #{amount}
        ]]>
    </select>

    <select id="getTotalCount" parameterType="com.boot.dto.Criteria" resultType="int">
        SELECT COUNT(*) FROM RECALL_BOARD WHERE 1=1
        <include refid="criteria"/>
    </select>
</mapper>