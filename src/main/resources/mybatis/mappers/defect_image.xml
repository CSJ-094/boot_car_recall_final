<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.boot.dao.DefectImageDAO">

    <insert id="insertImage" parameterType="com.boot.dto.DefectImageDTO">
        <selectKey keyProperty="imageId" resultType="long" order="BEFORE">
            SELECT DEFECT_REPORT_IMAGES_SEQ.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO DEFECT_REPORT_IMAGES (
            IMAGE_ID, REPORT_ID, FILE_NAME
        ) VALUES (
            #{imageId},
            #{reportId},
            #{fileName}
        )
    </insert>

    <resultMap id="defectImageResultMap" type="com.boot.dto.DefectImageDTO">
        <result property="imageId" column="IMAGE_ID"/>
        <result property="reportId" column="REPORT_ID"/>
        <result property="fileName" column="FILE_NAME"/>
    </resultMap>

    <select id="selectImagesByReportId" parameterType="long" resultMap="defectImageResultMap">
        SELECT
            IMAGE_ID, REPORT_ID, FILE_NAME
        FROM DEFECT_REPORT_IMAGES
        WHERE REPORT_ID = #{reportId}
        ORDER BY IMAGE_ID ASC
    </select>

    <delete id="deleteImagesByReportId" parameterType="long">
        DELETE FROM DEFECT_REPORT_IMAGES WHERE REPORT_ID = #{reportId}
    </delete>

    <delete id="deleteImageByFileName" parameterType="map">
        DELETE FROM DEFECT_REPORT_IMAGES WHERE REPORT_ID = #{reportId} AND FILE_NAME = #{fileName}
    </delete>

</mapper>