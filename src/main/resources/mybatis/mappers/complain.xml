<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.boot.dao.ComplainDAO">

	 <resultMap id="Map" type="com.boot.dto.ComplainDTO">
        <result property="report_id" column="REPORT_ID"/>
        <result property="reporter_name" column="REPORTER_NAME"/>
        <result property="password" column="PASSWORD"/>
        <result property="phone" column="PHONE"/>
        <result property="title" column="TITLE"/>
        <result property="complain_type" column="COMPLAIN_TYPE"/>
        <result property="carNum" column="CARNUM"/>
        <result property="is_public" column="IS_PUBLIC"/>
        <result property="complainDate" column="COMPLAINDATE"/>
        <result property="content" column="CONTENT"/>
        <result property="answer" column="ANSWER"/>
    </resultMap>

    <select id="complain_list" resultMap="Map">
        select REPORT_ID, REPORTER_NAME, PASSWORD, PHONE, TITLE, COMPLAIN_TYPE, CARNUM, IS_PUBLIC, CONTENT, ANSWER, TO_CHAR(COMPLAINDATE, 'YYYY-MM-DD HH24:MI') AS COMPLAINDATE
        from ONLINE_COMPLAIN
        order by REPORT_ID desc
    </select>
   
    <select id="find_modify_content" parameterType="hashmap" resultMap="Map">
        select REPORT_ID, REPORTER_NAME, PASSWORD, PHONE, TITLE, COMPLAIN_TYPE, CARNUM, IS_PUBLIC, CONTENT, ANSWER, TO_CHAR(COMPLAINDATE, 'YYYY-MM-DD HH24:MI') AS COMPLAINDATE
        from ONLINE_COMPLAIN
        where REPORT_ID = #{report_id}
    </select>
    
     <insert id="complain_write">
    	insert into online_complain(report_id, reporter_name, password, phone, title, COMPLAIN_TYPE, carNum, is_public, content) 
    	values(REPORT_ID.NEXTVAL, #{reporter_name, jdbcType=VARCHAR}, #{password, jdbcType=VARCHAR}, #{phone, jdbcType=VARCHAR}, #{title, jdbcType=VARCHAR}, 
    	#{complain_type, jdbcType=VARCHAR}, #{carNum, jdbcType=VARCHAR}, #{is_public, jdbcType=VARCHAR}, #{content, jdbcType=VARCHAR})
    </insert>
    
      <select id="contentView" parameterType="hashmap" resultMap="Map">
    	select REPORT_ID, REPORTER_NAME, PASSWORD, PHONE, TITLE, COMPLAIN_TYPE, CARNUM, IS_PUBLIC, CONTENT, ANSWER, TO_CHAR(COMPLAINDATE, 'YYYY-MM-DD HH24:MI') AS COMPLAINDATE
        from ONLINE_COMPLAIN
        where REPORT_ID = #{report_id}
    </select>
    
    <update id="complain_modify">
    	update online_complain set title=#{title}, COMPLAIN_TYPE=#{complain_type}, content=#{content} 
    	 where report_id=#{report_id}
    </update>
    
    <delete id="complain_delete">
    	delete from online_complain where report_id=#{report_id}
    </delete>

    <update id="updateAnswer" parameterType="hashmap">
        UPDATE ONLINE_COMPLAIN
        SET ANSWER = #{answer}
        WHERE REPORT_ID = #{report_id}
    </update>

</mapper>
